# ИИ-Нумеролог - Телеграм-бот

Телеграм-бот "ИИ-Нумеролог" выполняет нумерологические расчеты, предоставляет персонализированные отчеты и прогнозы на основе искусственного интеллекта.

## Основные функции

- Сбор данных пользователя (ФИО, дата рождения)
- Выполнение нумерологических расчетов
- Предоставление бесплатного мини-отчета
- Генерация и отправка платного полного PDF-отчета
- Расчет нумерологической совместимости
- Еженедельные прогнозы для подписчиков

## Технический стек

- **Python 3.10+** - основной язык программирования
- **aiogram 3.x** - фреймворк для создания Telegram ботов
- **PostgreSQL** - база данных для хранения информации о пользователях и заказах
- **Redis** - для хранения состояний конечного автомата (FSM)
- **n8n** - для интеграции с API искусственного интеллекта
- **Docker** - для контейнеризации и развертывания
- **weasyprint** - для генерации PDF-отчетов

## Структура проекта

```
ИИ-Нумеролог/
├── bot.py                # Основной файл бота
├── numerology_core.py    # Модуль для нумерологических расчетов
├── database.py           # Модуль работы с базой данных
├── interpret.py          # Модуль для интеграции с n8n и ИИ
├── payment_webhook.py    # Обработчик вебхуков платежей
├── pdf_generator.py      # Модуль для генерации PDF-отчетов
├── pdf_template.html     # HTML-шаблон для генерации PDF
├── requirements.txt      # Зависимости проекта
├── schema.sql            # Схема базы данных
├── dockerfile            # Инструкции для сборки Docker-образа
├── docker-compose.yml    # Конфигурация Docker-композиции
└── README.md             # Документация проекта
```

## Установка и запуск

### Запуск с Docker в тестовом режиме

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/your-username/numerology-bot.git
   cd numerology-bot
   ```

2. Создайте файл `.env` с необходимыми переменными окружения:
   ```
   # Telegram Bot
   BOT_TOKEN=your_bot_token_here
   
   # Тестовый режим (без реальных платежей)
   TEST_MODE=true
   ```

3. Запустите контейнеры:
   ```bash
   docker-compose up -d
   ```

4. Проверьте логи:
   ```bash
   docker-compose logs -f bot
   ```

В тестовом режиме (`TEST_MODE=true`) бот будет работать без реальных платежей, предоставляя возможность тестировать все функции бесплатно.

### Настройка для продакшн

Для запуска в продакшн режиме с реальными платежами:

1. Получите платежный токен от BotFather через команду `/mybots` -> Ваш бот -> Payments

2. Обновите `.env` файл:
   ```
   # Telegram Bot
   BOT_TOKEN=your_bot_token_here
   PAYMENT_PROVIDER_TOKEN=your_payment_provider_token_here
   PAYMENT_TOKEN_SECRET=your_payment_secret_here
   
   # Деактивация тестового режима
   TEST_MODE=false
   
   # Вебхук для продакшна
   WEBHOOK_HOST=https://your-domain.com
   ```

3. Перезапустите контейнеры:
   ```bash
   docker-compose down
   docker-compose up -d
   ```

## Настройка n8n для ИИ-интеграции

1. Откройте веб-интерфейс n8n (по умолчанию http://localhost:5678).

2. Создайте следующие рабочие процессы (workflows):
   - `numerology-mini-report` - для обработки мини-отчетов
   - `numerology-full-report` - для обработки полных отчетов
   - `numerology-compatibility` - для обработки расчетов совместимости
   - `weekly-forecast` - для еженедельных прогнозов

3. Настройте каждый процесс для интеграции с AI (OpenAI, Claude и т.д.)

### Пример настройки n8n для интеграции с OpenAI

1. Создайте новый workflow и назовите его `numerology-mini-report`
2. Добавьте узел `Webhook`
3. Настройте его как POST метод и скопируйте сгенерированный URL
4. Добавьте узел `OpenAI`
5. Настройте его для использования Chat Completion API
6. Подготовьте промпт для обработки нумерологических данных
7. Настройте выход для формирования JSON-ответа с интерпретацией
8. Сохраните и активируйте workflow

В тестовом режиме интеграция с n8n не требуется - бот будет генерировать тестовые ответы автоматически.

## Команды бота

- `/start` - Запуск бота и начало взаимодействия
- `/report` - Получение последнего купленного отчета
- `/subscribe` - Управление подпиской на еженедельные прогнозы
- `/compatibility` - Расчет совместимости с другим человеком
- `/help` - Справка и информация о боте
- `/settings` - Настройки языка и уведомлений

## Разработка и тестирование

Для разработки и тестирования новых функций рекомендуется использовать тестовый режим:

1. Установите `TEST_MODE=true` в файле `.env`
2. При запуске бот будет предоставлять тестовые кнопки для получения платного контента бесплатно
3. Модуль `interpret.py` будет генерировать тестовые ответы вместо реальных запросов к n8n

## Лицензия

Проект распространяется под лицензией MIT.

## Поддержка

По всем вопросам и предложениям обращайтесь через issues в GitHub или напрямую к администратору бота.